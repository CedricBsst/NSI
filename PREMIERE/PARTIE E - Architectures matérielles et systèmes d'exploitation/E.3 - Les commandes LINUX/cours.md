# Chapitre E.3 - **Les commandes LINUX**
## I. Le système de fichier LINUX
Dans la philosophie UNIX, dont découle le noyau Linux, toutes les ressources de l'ordinateur sont des fichiers. Une grande partie des commandes permettent de travailler sur le fichiers et les répertoires du système d'exploitation. 

Le schéma ci-dessous represente un arborescence de fichier Linux

![arbo1](./media/arbo1.png)

Le répertoire `/` représente le premier répertoire de l'arborescence. Il est appelé "racine".

### A. Le chemin absolu
Le chemin absolu d'un fichier ou d'un répertoire correspond au chemin à réaliser depuis la racine jusqu'à son emplacement. Un chemin absolu commence toujours par le caractère `/` qui correspond à la racine puis chaque répertoire traversé, séparé par le caractère `/`.

Par exemple, pour accéder au fichier "rapport.odt", on passe par les répertoires : home, elsa, documents et boulot. Le chemin absolu de ce fichier et donc :
```bash
/home/elsa/documents/boulot/rapport.odt
```

### B. Le chemin relatif
Le chemin relatif d'un fichier ou d'un répertoire correspond au chemin à réaliser depuis un autre répertoire du système de fichier. Un chemin relatif contient chaque répertoire traversé, séparé par le caractère `/`.

Par exemple, depuis le répertoire "elsa", pour accéder au fichier "rapport.odt" on passe par les répertoires : documents et boulots. Le chemin relatif du fichier "rapport.odt" depuis le répertoire "elsa" est :
```bash
documents/boulot/rapport.odt
```
> Pour savoir si un chemin est un chemin absolu ou un chemin relatif on regarde le premier caractère :
> - Si le premier caractère est un `/`, il s'agit d'un chemin absolu
> - Si le premier caractère n'est pas un `/`, il s'agit d'un chemin relatif

### C. Chemin spéciaux
Il est parfois nécessaire de faire référence au répertoire dans lequel on se situe. Le chemin actuel est représenté par le caractère `.`.

Ainsi depuis le répertoire "documents", le chemin
```bash
./fiche.ods
```
désigne le document "fiche.ods"

Il est parfois nécessaire de faire référence au répertoire parent du répertoire dans lequel on se situe. Le chemin du répertoire parent est représenté par les caractères `..` .

ainsi depuis le répertoire "elsa", le chemin
```bash
../max/images/photos_vac/photo_1.jpg
```
désigne le fichier "photo_1.jpg".

## II. Les commandes de bases Linux
| Commande    | Description                                   | Utilisation de base                            | Options courantes                                |
|-------------|-----------------------------------------------|------------------------------------------------|--------------------------------------------------|
| `ls`        | Liste les fichiers et répertoires             | `ls`                                           | `-l` (détails), `-a` (inclut les fichiers cachés)|
| `cd`        | Change de répertoire                          | `cd /chemin/vers/dossier`                      | `cd ..` (remonte d'un niveau) `cd` (renvoie vers le répertoire personnel de l'utilisateur)|
| `pwd`       | Affiche le répertoire courant                 | `pwd`                                          |                                                  |
| `cp`        | Copie des fichiers ou répertoires             | `cp fichier1 fichier2`                         | `-i` (demander confirmation)                     |
| `mv`        | Déplace ou renomme des fichiers ou répertoires| `mv fichier1 fichier2`                         | `-i` (demander confirmation)                     |
| `rm`        | Supprime des fichiers ou répertoires          | `rm fichier`                                   | `-r` (récursif), `-f` (force), `-i` (demander confirmation)|
| `touch`     | Crée un fichier vide ou met à jour la date de modification| `touch fichier`                    |                                                |
| `mkdir`     | Crée un répertoire                            | `mkdir dossier`                                | `-p` (crée les répertoires parents si nécessaire)|
| `rmdir`     | Supprime un répertoire vide                  | `rmdir dossier`                                 |                                                  |
| `cat`       | Affiche le contenu d'un fichier               | `cat fichier`                                  | `-n` (numérote les lignes), `-b` (numérote les lignes non vides) |
| `man`       | Affiche le manuel d'une commande              | `man commande`                                 | `-k` (cherche dans la base de données des manuels) |
| `shutdown`  | Éteint ou redémarre le système                | `shutdown -h now`                              | `-r` (redémarre), `-h` (arrête le système)       |
| `reboot`    | Redémarre le système                          | `reboot`                                       | -                                                |
| `ping`      | Vérifie la connectivité réseau                | `ping adresse`                                 | `-c` (nombre de requêtes), `-i` (intervalle)     |
| `ifconfig`  | Affiche ou configure les interfaces réseau    | `ifconfig`                                     | `-a` (affiche toutes les interfaces)             |
| `zip`       | Crée une archive ZIP                          | `zip archive.zip fichier`                      |                                                  |
| `unzip`     | Décompresse une archive ZIP                   | `unzip archive.zip`                            | `-l` (affiche la liste des fichiers)             |
| `grep`      | Recherche un texte dans un fichier            | `grep "mot" fichier`                           | `-r` (récursif), `-i` (insensible à la casse)    |
|`sudo` | Permet d'exécuter une commande avec les priviléges administrateur| `sudo commande`||

## III. Gestion des droits des utilisateurs
Le système de droits et de permissions sous UNIX est un aspect fondamental de la gestion de la sécurité du système.
### A. Les utilisateurs
Du point de vue d’un fichier ou d’un répertoire, LINUX divise les utilisateurs en trois type :
- L’utilisateur (user) – Le propriétaire du fichier
- Le groupe (group) – Le groupe propriétaire du fichier
- Le reste du monde (others) – Les autres utilisateurs

### B. Lecture de droits
En utilisant la commande `ls -l` on obtient un affichage comme celui-ci dessous :

```bash
-rwxr-xr-- roza staff 0 6 mai 11:56 monfic.sh
```

La partie `-rwxr-xr--` indique les droits des utilisateurs sur le fichier. Celle-ci se lit en ommettant le premier `-`.
> Le premier élément contient un `-` si l'élément est un fichier et contient un `d` si l'élément est un dossier

On divise l'élément en trois partie :
- rwx (contient les droits de l'utilisateur propriétaire du fichier)
- r-x (contient les droits du groupe propriétaire du fichier)
- r-- (contient les droits de tous les autres utilisateurs)

Chaque partie est elle-même composée de trois éléments :
- `r` droit de lecture sur le fichier (read)
- `w` droit d'écriture sur le fichier (write)
- `x` droit d'exècuter le fichier (execute)
  
### C. Modifier les droits des utilisateurs
La commande `chmod` permet de modifier les droits d'un fichier.

Pour utiliser la commande `chmod`, on peut spécifier les droits en utilisant deux méthodes principales : 

#### 1. Méthode symbolique
La méthode symbolique permet de modifier les droits en précisant les utilisateurs concernés et les droits à ajouter ou retirer. La syntaxe est la suivante :
```bash
chmod [utilisateur][opération][droits] fichier
```
- **Utilisateur** :
  - `u` : utilisateur propriétaire (user)
  - `g` : groupe propriétaire (group)
  - `o` : autres utilisateurs (others)
  - `a` : tous les utilisateurs (all)

- **Opération** :
  - `+` : ajoute un droit
  - `-` : retire un droit
  - `=` : remplace les droits existants

- **Droits** :
  - `r` : lecture (read)
  - `w` : écriture (write)
  - `x` : exécution (execute)

**Exemples** :
- Ajouter le droit d'exécution pour tous les utilisateurs :
  ```bash
  chmod a+x script.sh
  ```
- Retirer le droit d'écriture pour le groupe :
  ```bash
  chmod g-w fichier.txt
  ```
- Donner uniquement le droit de lecture à tous les utilisateurs :
  ```bash
  chmod a=r fichier.txt
  ```

#### 2. Méthode numérique (octale)
La méthode numérique utilise une valeur octale pour représenter les droits. Chaque droit est représenté par un chiffre :
- Lecture (`r`) : 4
- Écriture (`w`) : 2
- Exécution (`x`) : 1

On additionne les valeurs pour chaque catégorie d'utilisateur (propriétaire, groupe, autres) :
- `7` : lecture + écriture + exécution (4+2+1)
- `6` : lecture + écriture (4+2)
- `5` : lecture + exécution (4+1)
- `4` : lecture seule
- `0` : aucun droit

La syntaxe est la suivante :
```bash
chmod [valeur] fichier
```

**Exemples** :
- Donner tous les droits au propriétaire, lecture et exécution au groupe, et aucun droit aux autres :
  ```bash
  chmod 750 fichier.txt
  ```
- Donner uniquement le droit de lecture à tous les utilisateurs :
  ```bash
  chmod 444 fichier.txt
  ```

#### 2. Méthode numérique (octale)
La méthode numérique utilise une valeur octale pour représenter les droits. Chaque droit est représenté par un chiffre :
- Lecture (`r`) : 4
- Écriture (`w`) : 2
- Exécution (`x`) : 1

On additionne les valeurs pour chaque catégorie d'utilisateur (propriétaire, groupe, autres) :
- `7` : lecture + écriture + exécution (4+2+1)
- `6` : lecture + écriture (4+2)
- `5` : lecture + exécution (4+1)
- `4` : lecture seule
- `0` : aucun droit

La syntaxe est la suivante :
```bash
chmod [valeur] fichier
```

**Exemples** :
- Donner tous les droits au propriétaire, lecture et exécution au groupe, et aucun droit aux autres :
  ```bash
  chmod 750 fichier.txt
  ```
- Donner uniquement le droit de lecture à tous les utilisateurs :
  ```bash
  chmod 444 fichier.txt
  ```

### D. Vérifier les droits
Pour vérifier les droits d'un fichier ou d'un répertoire, utilisez la commande :
```bash
ls -l fichier
```
Cela affichera les droits actuels sous forme symbolique.

### E. Changer le propriétaire ou le groupe
Pour modifier le propriétaire ou le groupe d'un fichier, utilisez les commandes suivantes :
- Changer le propriétaire :
  ```bash
  chown utilisateur fichier
  ```
- Changer le groupe :
  ```bash
  chgrp groupe fichier
  ```
- Changer à la fois le propriétaire et le groupe :
  ```bash
  chown utilisateur:groupe fichier
  ```

**Exemple** :
- Attribuer le fichier `rapport.txt` à l'utilisateur `elsa` et au groupe `staff` :
  ```bash
  chown elsa:staff rapport.txt
  ```

> **Remarque** : Ces commandes nécessitent souvent des privilèges administratifs. Utilisez `sudo` si nécessaire.